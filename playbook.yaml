- name: run the playbook tasks on the localhost
  hosts: localhost
  connection: local
  tasks:
  - name: Tweak GRUB
    import_tasks: tasks/grub.yaml

  - name: Enable periodic SSD trim
    become: yes
    systemd:
        name: fstrim.timer
        enabled: yes
        state: started

  - name: Setup yubikey
    import_tasks: tasks/yubikey.yaml 

  - name: Enable natural scrolling
    become: yes
    blockinfile:
        path: /etc/X11/xorg.conf.d/30-touchpad.conf
        insertafter: "Option \"Tapping\" \"on\""
        block: |
          "Option" "NaturalScrolling" "true"

  - name: Setup NVidia/Bumblebee
    import_tasks: tasks/bumblebee.yaml

  - name: Setup TLP
    import_tasks: tasks/tlp.yaml  
    
  - name: Setup SSHD
    import_tasks: tasks/sshd.yaml

  - name: Install script for auto-timezone adjustment
    become: yes
    copy:
        src: files/update-tz.sh
        dest: /etc/NetworkManager/dispatcher.d/09-timezone
        mode: 0755

  - name: Install yay for AUR support
    pacman: name=yay state=present
        
  - name: Install common packages
    yay:
        name:
        - go
        - go-tools
        - xorg-xbacklight
        - redshift
        - unzip
        - zip
        - spotify
        - goland
        - visual-studio-code-bin
        - xss-lock
        - zoom
        - firefox
        - google-chrome
        - ttf-croscore
        - ttf-dejavu
        - ttf-mac-fonts
        - ttf-google-fonts-git>=r1377
        - ttf-ms-fonts

  - name: Copy config files
    copy:
        src: "files/{{ item.src }}"
        dest: "/home/dizzyd/{{ item.dest }}"
        mode: "{{ item.mode }}"
    with_items:
        - {src: "i3.config", dest: ".i3/config", mode: 0644}
        - {src: "i3.net-speed.sh", dest: "net-speed.sh", mode: 0755}
        - {src: "Xresources", dest: ".Xresources", mode: 0644}
